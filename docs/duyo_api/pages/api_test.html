<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duyo API í…ŒìŠ¤íŠ¸ í˜ì´ì§€</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .json-viewer {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .btn-active {
            background-color: #3b82f6 !important;
            color: white !important;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="container mx-auto px-4 max-w-7xl">
        <!-- í—¤ë” -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ§ª Duyo Story API í…ŒìŠ¤íŠ¸</h1>
            <p class="text-gray-600">APIë¥¼ í…ŒìŠ¤íŠ¸í•˜ê³  ìš”ì²­/ì‘ë‹µ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- ì™¼ìª½: ì…ë ¥ í¼ -->
            <div class="bg-white rounded-lg shadow-md p-6 max-h-[calc(100vh-200px)] overflow-y-auto">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ API ìš”ì²­ ì„¤ì •</h2>
                
                <form id="apiTestForm">
                    <!-- API ì¸ì¦ -->
                    <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded">
                        <h3 class="font-semibold text-gray-800 mb-3">ğŸ”‘ ì¸ì¦ ì •ë³´</h3>
                        
                        <div class="mb-3">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Duyo API Key</label>
                            <input type="text" id="apiKey" value="sk-yumeta-duyo-270091" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">OpenRouter API Key *</label>
                            <input type="text" id="openrouterKey" placeholder="sk-or-v1-... (í•„ìˆ˜)" 
                                   class="w-full px-3 py-2 border border-red-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm" required>
                            <p class="text-xs text-red-500 mt-1">âš ï¸ í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤</p>
                        </div>
                    </div>

                    <!-- ëª¨ë¸ ì„ íƒ -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">AI ëª¨ë¸</label>
                        <div class="flex gap-2">
                            <button type="button" class="model-btn flex-1 py-2 px-4 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors" data-model="claude-3-7">
                                Claude 3.7
                            </button>
                            <button type="button" class="model-btn flex-1 py-2 px-4 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors" data-model="claude-4">
                                Claude 4
                            </button>
                            <button type="button" class="model-btn flex-1 py-2 px-4 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors btn-active" data-model="claude-4-5">
                                Claude 4.5
                            </button>
                        </div>
                    </div>

                    <!-- í˜ë¥´ì†Œë‚˜ íƒ€ì… -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">í˜ë¥´ì†Œë‚˜ íƒ€ì… *</label>
                        <select id="personaType" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="ì¼ë°˜ì¸ ì°">ì¼ë°˜ì¸ ì°</option>
                            <option value="ì •ë³´ê¸€">ì •ë³´ê¸€</option>
                            <option value="ê°„ì ‘ê´‘ê³ ">ê°„ì ‘ê´‘ê³ </option>
                        </select>
                    </div>

                    <!-- ë§íˆ¬ ì„ íƒ -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">ë§íˆ¬</label>
                        <select id="toneType" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="ìë™">ìë™</option>
                            <option value="ìŒìŠ´ì²´">ìŒìŠ´ì²´</option>
                            <option value="í•´ìš”ì²´">í•´ìš”ì²´</option>
                            <option value="ë‹¤ë‚˜ê¹Œ">ë‹¤ë‚˜ê¹Œì²´</option>
                            <option value="ì‚¬ê·¹ì²´">ì‚¬ê·¹ì²´</option>
                            <option value="ìƒë‚¨ì">ìƒë‚¨ì</option>
                            <option value="ê²½ìƒë„ì²´">ê²½ìƒë„ì²´</option>
                            <option value="ì „ë¼ë„ì²´">ì „ë¼ë„ì²´</option>
                            <option value="ì¶©ì²­ë„ì²´">ì¶©ì²­ë„ì²´</option>
                            <option value="ì¹œêµ¬ì²´">ì¹œêµ¬ì²´</option>
                            <option value="ë””ì”¨ì²´">ë””ì”¨ì¸ì‚¬ì´ë“œì²´</option>
                        </select>
                    </div>

                    <!-- ì¥ë¥´ ì„ íƒ -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì¥ë¥´</label>
                        <div class="flex flex-wrap gap-2 mb-2">
                            <button type="button" class="genre-btn px-3 py-1 rounded-full text-xs bg-gray-100 hover:bg-gray-200 transition-colors" data-genre="">ì„ íƒ ì•ˆ í•¨</button>
                            <button type="button" class="genre-btn px-3 py-1 rounded-full text-xs bg-gray-100 hover:bg-gray-200 transition-colors" data-genre="ì•Œë°”">ì•Œë°” ì°</button>
                            <button type="button" class="genre-btn px-3 py-1 rounded-full text-xs bg-gray-100 hover:bg-gray-200 transition-colors" data-genre="í•™êµ">í•™êµ ì°</button>
                            <button type="button" class="genre-btn px-3 py-1 rounded-full text-xs bg-gray-100 hover:bg-gray-200 transition-colors" data-genre="êµ°ëŒ€">êµ°ëŒ€ ì°</button>
                            <button type="button" class="genre-btn px-3 py-1 rounded-full text-xs bg-gray-100 hover:bg-gray-200 transition-colors" data-genre="ê°€ì¡±">ê°€ì¡± ì°</button>
                            <button type="button" class="genre-btn px-3 py-1 rounded-full text-xs bg-gray-100 hover:bg-gray-200 transition-colors" data-genre="ì—°ì• ">ì—°ì•  ì°</button>
                            <button type="button" class="genre-btn px-3 py-1 rounded-full text-xs bg-gray-100 hover:bg-gray-200 transition-colors" data-genre="ë™ë¬¼">ë™ë¬¼ ì°</button>
                            <button type="button" class="genre-btn px-3 py-1 rounded-full text-xs bg-gray-100 hover:bg-gray-200 transition-colors" data-genre="ì—¬í–‰">ì—¬í–‰ ì°</button>
                            <button type="button" class="genre-btn px-3 py-1 rounded-full text-xs bg-gray-100 hover:bg-gray-200 transition-colors" data-genre="ë§ì§±, ì‹¸ì›€">ë§ì§± ì°</button>
                            <button type="button" class="genre-btn px-3 py-1 rounded-full text-xs bg-gray-100 hover:bg-gray-200 transition-colors" data-genre="ì¹œêµ¬">ì¹œêµ¬ ì°</button>
                            <button type="button" class="genre-btn px-3 py-1 rounded-full text-xs bg-gray-100 hover:bg-gray-200 transition-colors" data-genre="í‘ì—­ì‚¬">í‘ì—­ì‚¬</button>
                        </div>
                        <input type="text" id="customGenre" placeholder="ë˜ëŠ” ì§ì ‘ ì…ë ¥..." class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- ì£¼ì œ -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1">ì£¼ì œ *</label>
                        <textarea id="topic" rows="3" placeholder="ì˜ˆ: íšŒì‚¬ì—ì„œ ìˆì—ˆë˜ í™©ë‹¹í•œ ì¼" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <!-- ê´‘ê³  ìƒí’ˆ (ê°„ì ‘ê´‘ê³ ì¼ ë•Œë§Œ í‘œì‹œ) -->
                    <div id="adProductField" class="mb-4 hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-1">ê´‘ê³  ìƒí’ˆ *</label>
                        <textarea id="adProduct" rows="3" placeholder="ì˜ˆ: ABC ë‹¤ì´ì–´íŠ¸ ë³´ì¡°ì œ" 
                                  class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                    </div>

                    <!-- ì¶”ê°€ ìš”ì²­ì‚¬í•­ -->
                    <div class="mb-4">
                        <label class="flex items-center mb-2">
                            <input type="checkbox" id="additionalRequestCheck" class="mr-2">
                            <span class="text-sm text-gray-700">ì¶”ê°€ ìš”ì²­ì‚¬í•­</span>
                        </label>
                        <div id="additionalRequestField" class="hidden">
                            <textarea id="additionalRequest" rows="2" placeholder="ì¶”ê°€ ìš”ì²­ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”" 
                                      class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                    </div>

                    <!-- ì˜µì…˜ ê·¸ë¦¬ë“œ -->
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ë¶„ìœ„ê¸°</label>
                            <select id="storyMood" class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="ìë™">ìë™</option>
                                <option value="ì›ƒê¸°ê²Œ">ì›ƒê¸°ê²Œ</option>
                                <option value="ì§„ì§€í•˜ê²Œ">ì§„ì§€í•˜ê²Œ</option>
                                <option value="í—ˆë¬´í•˜ê²Œ">í—ˆë¬´í•˜ê²Œ</option>
                                <option value="ë¬´ì„­ê²Œ">ë¬´ì„­ê²Œ</option>
                                <option value="ìŠ¬í”„ê²Œ">ìŠ¬í”„ê²Œ</option>
                                <option value="ì„¤ë ˆê²Œ">ì„¤ë ˆê²Œ</option>
                                <option value="ê°ë™ì ìœ¼ë¡œ">ê°ë™ì ìœ¼ë¡œ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ê²°ë§ ìŠ¤íƒ€ì¼</label>
                            <select id="endingStyle" class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="ìë™">ìë™</option>
                                <option value="í•´í”¼ì—”ë”©">í•´í”¼ì—”ë”©</option>
                                <option value="ë°˜ì „">ë°˜ì „ì—”ë”©</option>
                                <option value="ì—¬ìš´">ì—¬ìš´ìˆëŠ” ê²°ë§</option>
                                <option value="ìŠ¬í”ˆ">ìŠ¬í”ˆ ê²°ë§</option>
                                <option value="í›ˆí›ˆ">í›ˆí›ˆí•œ ê²°ë§</option>
                                <option value="ì¶©ê²©">ì¶©ê²©ì  ê²°ë§</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">í™”ì ì„±ë³„</label>
                            <select id="narratorGender" class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="ìë™">ìë™</option>
                                <option value="ë‚¨ì„±">ë‚¨ì„±</option>
                                <option value="ì—¬ì„±">ì—¬ì„±</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">í™”ì ë‚˜ì´ëŒ€</label>
                            <select id="narratorAge" class="w-full px-3 py-2 border border-gray-300 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="ìë™">ìë™</option>
                                <option value="10ëŒ€">10ëŒ€</option>
                                <option value="20ëŒ€">20ëŒ€</option>
                                <option value="30ëŒ€">30ëŒ€</option>
                                <option value="40ëŒ€">40ëŒ€</option>
                                <option value="50ëŒ€">50ëŒ€</option>
                            </select>
                        </div>
                    </div>

                    <!-- ìˆ˜ìœ„ ì¡°ì ˆ -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ìˆ˜ìœ„ ì¡°ì ˆ</label>
                        <div class="flex gap-2 items-center">
                            <button type="button" class="level-btn px-3 py-1.5 rounded-full text-sm bg-gray-100 hover:bg-gray-200 transition-colors" data-level="1">ìˆœí•œë§›</button>
                            <button type="button" class="level-btn px-3 py-1.5 rounded-full text-sm bg-blue-200 text-blue-800 hover:bg-blue-300 transition-colors btn-active" data-level="2">ì¤‘ê°„ë§›</button>
                            <button type="button" class="level-btn px-3 py-1.5 rounded-full text-sm bg-gray-100 hover:bg-gray-200 transition-colors" data-level="3">ë§¤ìš´ë§›</button>
                            <button type="button" id="adultButton" class="hidden px-3 py-1.5 rounded-full text-sm bg-red-100 text-red-600 hover:bg-red-200 transition-colors">ğŸ”</button>
                        </div>
                    </div>

                    <!-- ì° ê¸¸ì´ -->
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì° ê¸¸ì´</label>
                        <div class="flex gap-2">
                            <button type="button" class="length-btn px-3 py-1.5 rounded-full text-sm bg-gray-100 hover:bg-gray-200 transition-colors" data-length="short">ì§§ê²Œ</button>
                            <button type="button" class="length-btn px-3 py-1.5 rounded-full text-sm bg-blue-200 text-blue-800 hover:bg-blue-300 transition-colors btn-active" data-length="medium">ì¤‘ê°„</button>
                            <button type="button" class="length-btn px-3 py-1.5 rounded-full text-sm bg-gray-100 hover:bg-gray-200 transition-colors" data-length="long">ê¸¸ê²Œ</button>
                        </div>
                    </div>

                    <!-- ì²´í¬ë°•ìŠ¤ ì˜µì…˜ -->
                    <div class="mb-4 p-3 bg-gray-50 rounded">
                        <label class="flex items-center mb-2">
                            <input type="checkbox" id="splitEnding" class="mr-2">
                            <span class="text-sm text-gray-700">ê²°ë§ A/B ë¶„ê¸°</span>
                        </label>
                        <label class="flex items-center mb-2">
                            <input type="checkbox" id="includeComments" class="mr-2">
                            <span class="text-sm text-gray-700">ëŒ“ê¸€ í¬í•¨</span>
                        </label>
                        <label class="flex items-center mb-2">
                            <input type="checkbox" id="includeQuestions" class="mr-2">
                            <span class="text-sm text-gray-700">ë§ˆë¬´ë¦¬ ì§ˆë¬¸ í¬í•¨</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="limitCharacters" checked class="mr-2">
                            <span class="text-sm text-gray-700">ë“±ì¥ì¸ë¬¼ ìˆ˜ ì œí•œ (3ëª… ì´í•˜)</span>
                        </label>
                    </div>

                    <!-- ë²„íŠ¼ -->
                    <button type="submit" id="testButton" 
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded transition duration-200">
                        ğŸš€ API í˜¸ì¶œí•˜ê¸°
                    </button>
                </form>
            </div>

            <!-- ì˜¤ë¥¸ìª½: ê²°ê³¼ -->
            <div class="space-y-6">
                <!-- ìš”ì²­ ë°ì´í„° -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“¤ ìš”ì²­ ë°ì´í„°</h2>
                    <div class="bg-gray-900 text-green-400 p-4 rounded overflow-auto max-h-96 json-viewer">
                        <pre id="requestData">APIë¥¼ í˜¸ì¶œí•˜ë©´ ìš”ì²­ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
                    </div>
                </div>

                <!-- ì‘ë‹µ ë°ì´í„° -->
                <div class="bg-white rounded-lg shadow-md p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold text-gray-800">ğŸ“¥ ì‘ë‹µ ë°ì´í„°</h2>
                        <div id="statusBadge"></div>
                    </div>
                    <div class="bg-gray-900 text-green-400 p-4 rounded overflow-auto max-h-96 json-viewer">
                        <pre id="responseData">API ì‘ë‹µì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
                    </div>
                </div>

                <!-- ìƒì„±ëœ ìŠ¤í† ë¦¬ ë¯¸ë¦¬ë³´ê¸° -->
                <div id="storyPreview" class="bg-white rounded-lg shadow-md p-6 hidden">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold text-gray-800">ğŸ“– ìƒì„±ëœ ìŠ¤í† ë¦¬</h2>
                        <div class="flex gap-2">
                            <button id="continueStoryBtn" class="px-4 py-2 bg-orange-600 hover:bg-orange-700 text-white text-sm font-semibold rounded transition duration-200">
                                ğŸ“ ì´ì–´ì“°ê¸°
                            </button>
                            <button id="splitSceneBtn" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm font-semibold rounded transition duration-200">
                                ğŸ¬ ì¥ë©´ ë‚˜ëˆ„ê¸°
                            </button>
                            <button id="refineStoryBtn" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white text-sm font-semibold rounded transition duration-200">
                                âœ¨ ê°€ê³µí•˜ê¸°
                            </button>
                        </div>
                    </div>
                    <div class="prose max-w-none">
                        <div id="storyContent" class="whitespace-pre-wrap text-gray-700 leading-relaxed"></div>
                    </div>
                </div>

                <!-- ì´ì–´ì“°ê¸° API ìš”ì²­/ì‘ë‹µ -->
                <div id="continueStoryApiSection" class="bg-white rounded-lg shadow-md p-6 hidden">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“ ì´ì–´ì“°ê¸° API</h2>
                    
                    <!-- ìš”ì²­ ë°ì´í„° -->
                    <div class="mb-4">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">ğŸ“¤ ìš”ì²­ ë°ì´í„°</h3>
                        <div class="bg-gray-900 text-green-400 p-3 rounded overflow-auto max-h-48 json-viewer">
                            <pre id="continueStoryRequestData">-</pre>
                        </div>
                    </div>
                    
                    <!-- ì‘ë‹µ ë°ì´í„° -->
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-semibold text-gray-700">ğŸ“¥ ì‘ë‹µ ë°ì´í„°</h3>
                            <span id="continueStoryStatusBadge"></span>
                        </div>
                        <div class="bg-gray-900 text-green-400 p-3 rounded overflow-auto max-h-48 json-viewer">
                            <pre id="continueStoryResponseData">-</pre>
                        </div>
                    </div>
                    
                    <!-- ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° -->
                    <div>
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-semibold text-gray-700">ğŸ“ í›„ì† ìŠ¤í† ë¦¬</h3>
                            <div class="flex gap-2">
                                <button id="copyContinueStoryBtn" class="px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white text-xs font-semibold rounded transition duration-200">
                                    ğŸ“‹ ë³µì‚¬
                                </button>
                                <button id="useContinuedStoryBtn" class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold rounded transition duration-200">
                                    â†©ï¸ ì´ ìŠ¤í† ë¦¬ ì‚¬ìš©
                                </button>
                            </div>
                        </div>
                        <div id="continueStoryContent" class="whitespace-pre-wrap text-gray-700 leading-relaxed bg-gray-50 p-4 rounded border text-sm max-h-64 overflow-auto"></div>
                    </div>
                    <div id="continueStoryTokenInfo" class="mt-3 text-xs text-gray-500"></div>
                </div>

                <!-- ì¥ë©´ ë‚˜ëˆ„ê¸° API ìš”ì²­/ì‘ë‹µ -->
                <div id="splitSceneApiSection" class="bg-white rounded-lg shadow-md p-6 hidden">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ¬ ì¥ë©´ ë‚˜ëˆ„ê¸° API</h2>
                    
                    <!-- ìš”ì²­ ë°ì´í„° -->
                    <div class="mb-4">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">ğŸ“¤ ìš”ì²­ ë°ì´í„°</h3>
                        <div class="bg-gray-900 text-green-400 p-3 rounded overflow-auto max-h-48 json-viewer">
                            <pre id="splitSceneRequestData">-</pre>
                        </div>
                    </div>
                    
                    <!-- ì‘ë‹µ ë°ì´í„° -->
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-semibold text-gray-700">ğŸ“¥ ì‘ë‹µ ë°ì´í„°</h3>
                            <span id="splitSceneStatusBadge"></span>
                        </div>
                        <div class="bg-gray-900 text-green-400 p-3 rounded overflow-auto max-h-48 json-viewer">
                            <pre id="splitSceneResponseData">-</pre>
                        </div>
                    </div>
                    
                    <!-- ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° -->
                    <div>
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm font-semibold text-gray-700">ğŸ“ ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</h3>
                            <button id="copySplitSceneBtn" class="px-3 py-1 bg-gray-600 hover:bg-gray-700 text-white text-xs font-semibold rounded transition duration-200">
                                ğŸ“‹ ë³µì‚¬
                            </button>
                        </div>
                        <div id="splitSceneContent" class="whitespace-pre-wrap text-gray-700 leading-relaxed bg-gray-50 p-4 rounded border text-sm max-h-64 overflow-auto"></div>
                    </div>
                    <div id="splitSceneTokenInfo" class="mt-3 text-xs text-gray-500"></div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let selectedModel = 'claude-4-5';
        let selectedGenre = '';
        let selectedLevel = '2';
        let selectedLength = 'medium';
        let isAdultContent = false;

        // ëª¨ë¸ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.querySelectorAll('.model-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.model-btn').forEach(b => b.classList.remove('btn-active', 'bg-blue-500', 'text-white'));
                this.classList.add('btn-active', 'bg-blue-500', 'text-white');
                selectedModel = this.dataset.model;
            });
        });

        // ì¥ë¥´ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.querySelectorAll('.genre-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.genre-btn').forEach(b => b.classList.remove('btn-active', 'bg-blue-500', 'text-white'));
                this.classList.add('btn-active', 'bg-blue-500', 'text-white');
                selectedGenre = this.dataset.genre;
                document.getElementById('customGenre').value = '';
            });
        });

        // ìˆ˜ìœ„ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.querySelectorAll('.level-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const level = this.dataset.level;
                document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('btn-active'));
                this.classList.add('btn-active');
                selectedLevel = level;
                
                // ë§¤ìš´ë§›(3)ì¼ ë•Œ ğŸ” ë²„íŠ¼ í‘œì‹œ
                const adultBtn = document.getElementById('adultButton');
                if (level === '3') {
                    adultBtn.classList.remove('hidden');
                } else {
                    adultBtn.classList.add('hidden');
                    isAdultContent = false;
                    adultBtn.classList.remove('btn-active');
                }
            });
        });

        // ì„±ì¸ ì½˜í…ì¸  ë²„íŠ¼
        document.getElementById('adultButton').addEventListener('click', function() {
            isAdultContent = !isAdultContent;
            this.classList.toggle('btn-active');
        });

        // ê¸¸ì´ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.querySelectorAll('.length-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.length-btn').forEach(b => b.classList.remove('btn-active'));
                this.classList.add('btn-active');
                selectedLength = this.dataset.length;
            });
        });

        // í˜ë¥´ì†Œë‚˜ íƒ€ì… ë³€ê²½ ì‹œ ê´‘ê³  ìƒí’ˆ í•„ë“œ í‘œì‹œ/ìˆ¨ê¹€
        document.getElementById('personaType').addEventListener('change', function() {
            const adProductField = document.getElementById('adProductField');
            if (this.value === 'ê°„ì ‘ê´‘ê³ ') {
                adProductField.classList.remove('hidden');
            } else {
                adProductField.classList.add('hidden');
            }
        });

        // ì¶”ê°€ ìš”ì²­ì‚¬í•­ ì²´í¬ë°•ìŠ¤
        document.getElementById('additionalRequestCheck').addEventListener('change', function() {
            const field = document.getElementById('additionalRequestField');
            if (this.checked) {
                field.classList.remove('hidden');
            } else {
                field.classList.add('hidden');
            }
        });

        // í¼ ì œì¶œ
        document.getElementById('apiTestForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const button = document.getElementById('testButton');
            const originalText = button.innerHTML;
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> ì²˜ë¦¬ì¤‘...';
            
            // ì¥ë¥´ ì²˜ë¦¬ (ì§ì ‘ ì…ë ¥ì´ ìˆìœ¼ë©´ ìš°ì„ )
            const customGenre = document.getElementById('customGenre').value.trim();
            const finalGenre = customGenre || selectedGenre;
            
            // ìš”ì²­ ë°ì´í„° êµ¬ì„±
            const requestData = {
                personaType: document.getElementById('personaType').value,
                topic: document.getElementById('topic').value,
                genre: finalGenre,
                toneType: document.getElementById('toneType').value,
                level: selectedLevel,
                length: selectedLength,
                model: selectedModel,
                storyMood: document.getElementById('storyMood').value,
                endingStyle: document.getElementById('endingStyle').value,
                narratorGender: document.getElementById('narratorGender').value,
                narratorAge: document.getElementById('narratorAge').value,
                includeComments: document.getElementById('includeComments').checked,
                includeQuestions: document.getElementById('includeQuestions').checked,
                splitEnding: document.getElementById('splitEnding').checked,
                limitCharacters: document.getElementById('limitCharacters').checked,
                isAdultContent: isAdultContent
            };

            // ê°„ì ‘ê´‘ê³ ì¸ ê²½ìš° adProduct ì¶”ê°€
            if (requestData.personaType === 'ê°„ì ‘ê´‘ê³ ') {
                requestData.adProduct = document.getElementById('adProduct').value;
            }

            // ì¶”ê°€ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ë©´ ì¶”ê°€
            if (document.getElementById('additionalRequestCheck').checked) {
                requestData.additionalRequest = document.getElementById('additionalRequest').value;
            }

            // ìš”ì²­ ë°ì´í„° í‘œì‹œ
            document.getElementById('requestData').textContent = JSON.stringify(requestData, null, 2);
            
            // OpenRouter API í‚¤ í™•ì¸
            const openrouterKey = document.getElementById('openrouterKey').value.trim();
            if (!openrouterKey) {
                alert('âš ï¸ OpenRouter API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!\n\nOpenRouter API í‚¤ëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.');
                button.disabled = false;
                button.innerHTML = originalText;
                return;
            }
            
            // í—¤ë” êµ¬ì„±
            const headers = {
                'Content-Type': 'application/json',
                'X-API-Key': document.getElementById('apiKey').value,
                'X-OpenRouter-Key': openrouterKey
            };

            try {
                console.log('Sending request to api.php');
                console.log('Headers:', headers);
                console.log('Request Data:', requestData);
                
                const response = await fetch('../api.php', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(requestData)
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                const responseText = await response.text();
                console.log('Response text:', responseText);
                
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseError) {
                    throw new Error('Invalid JSON response: ' + responseText.substring(0, 200));
                }
                
                // ìƒíƒœ ë°°ì§€ ì—…ë°ì´íŠ¸
                const statusBadge = document.getElementById('statusBadge');
                if (response.ok) {
                    statusBadge.innerHTML = '<span class="px-3 py-1 bg-green-100 text-green-800 text-sm font-semibold rounded-full">âœ“ ì„±ê³µ (' + response.status + ')</span>';
                } else {
                    statusBadge.innerHTML = '<span class="px-3 py-1 bg-red-100 text-red-800 text-sm font-semibold rounded-full">âœ— ì‹¤íŒ¨ (' + response.status + ')</span>';
                }
                
                // ì‘ë‹µ ë°ì´í„° í‘œì‹œ
                document.getElementById('responseData').textContent = JSON.stringify(data, null, 2);
                
                // ì„±ê³µí•œ ê²½ìš° ìŠ¤í† ë¦¬ ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                if (response.ok && data.content) {
                    document.getElementById('storyPreview').classList.remove('hidden');
                    document.getElementById('storyContent').textContent = data.content;
                } else {
                    document.getElementById('storyPreview').classList.add('hidden');
                }
                
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('statusBadge').innerHTML = '<span class="px-3 py-1 bg-red-100 text-red-800 text-sm font-semibold rounded-full">âœ— ì—ëŸ¬</span>';
                document.getElementById('responseData').textContent = 'Error: ' + error.message + '\n\n' + error.stack;
                document.getElementById('storyPreview').classList.add('hidden');
                
                // ì—ëŸ¬ ì•Œë¦¼
                alert('API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì½˜ì†”(F12)ì„ í™•ì¸í•˜ì„¸ìš”.\n\nError: ' + error.message);
            } finally {
                button.disabled = false;
                button.innerHTML = originalText;
            }
        });

        // í˜„ì¬ ìŠ¤í† ë¦¬ ì œëª© ì €ì¥ìš© ë³€ìˆ˜
        let currentStoryTitle = '';
        
        // ì´ì–´ì“°ê¸°
        document.getElementById('continueStoryBtn').addEventListener('click', async function() {
            const storyContent = document.getElementById('storyContent').textContent;
            const openrouterKey = document.getElementById('openrouterKey').value.trim();
            
            if (!storyContent) {
                alert('ì´ì–´ì“¸ ìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!openrouterKey) {
                alert('OpenRouter API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ì œëª© ì¶”ì¶œ (ì²« ë²ˆì§¸ ì¤„)
            const lines = storyContent.split('\n');
            const title = lines[0] || 'ì œëª©ì—†ìŒ';
            
            const button = this;
            const originalText = button.innerHTML;
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> ì²˜ë¦¬ì¤‘...';
            
            // ìš”ì²­ ë°ì´í„° êµ¬ì„±
            const requestData = {
                _openrouter_key: openrouterKey,
                previousStory: storyContent,
                previousTitle: title,
                model: selectedModel,
                level: selectedLevel
            };
            
            // API ì„¹ì…˜ í‘œì‹œ ë° ìš”ì²­ ë°ì´í„° í‘œì‹œ
            document.getElementById('continueStoryApiSection').classList.remove('hidden');
            document.getElementById('continueStoryRequestData').textContent = JSON.stringify({
                ...requestData,
                _openrouter_key: '***hidden***',
                previousStory: requestData.previousStory.substring(0, 100) + '...'
            }, null, 2);
            document.getElementById('continueStoryResponseData').textContent = 'ìš”ì²­ ì¤‘...';
            document.getElementById('continueStoryStatusBadge').innerHTML = '<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-semibold rounded-full">â³ ì²˜ë¦¬ì¤‘</span>';
            
            try {
                const response = await fetch('../continue_story.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                // ì‘ë‹µ ë°ì´í„° í‘œì‹œ
                document.getElementById('continueStoryResponseData').textContent = JSON.stringify(result, null, 2);
                
                if (result.content) {
                    document.getElementById('continueStoryStatusBadge').innerHTML = '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full">âœ“ ì„±ê³µ</span>';
                    document.getElementById('continueStoryContent').textContent = result.content;
                    
                    // í† í° ì •ë³´ í‘œì‹œ
                    if (result.token_info) {
                        document.getElementById('continueStoryTokenInfo').innerHTML = `
                            <span class="text-gray-600">ëª¨ë¸: ${result.metadata?.model || selectedModel}</span> | 
                            <span class="text-blue-600">Claude ì…ë ¥: ${result.token_info.claude?.input_tokens || 0}</span> | 
                            <span class="text-green-600">Claude ì¶œë ¥: ${result.token_info.claude?.output_tokens || 0}</span>
                        `;
                    }
                } else {
                    document.getElementById('continueStoryStatusBadge').innerHTML = '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs font-semibold rounded-full">âœ— ì‹¤íŒ¨</span>';
                    document.getElementById('continueStoryContent').textContent = 'ì˜¤ë¥˜: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                }
            } catch (error) {
                document.getElementById('continueStoryStatusBadge').innerHTML = '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs font-semibold rounded-full">âœ— ì—ëŸ¬</span>';
                document.getElementById('continueStoryResponseData').textContent = 'Error: ' + error.message;
                document.getElementById('continueStoryContent').textContent = 'ì˜¤ë¥˜ ë°œìƒ: ' + error.message;
            } finally {
                button.disabled = false;
                button.innerHTML = originalText;
            }
        });
        
        // ì´ì–´ì“°ê¸° ê²°ê³¼ ë³µì‚¬
        document.getElementById('copyContinueStoryBtn').addEventListener('click', function() {
            const content = document.getElementById('continueStoryContent').textContent;
            navigator.clipboard.writeText(content).then(() => {
                const originalText = this.innerHTML;
                this.innerHTML = 'âœ“ ë³µì‚¬ë¨';
                setTimeout(() => {
                    this.innerHTML = originalText;
                }, 2000);
            });
        });
        
        // ì´ì–´ì“´ ìŠ¤í† ë¦¬ë¥¼ ë©”ì¸ ìŠ¤í† ë¦¬ë¡œ ì‚¬ìš©
        document.getElementById('useContinuedStoryBtn').addEventListener('click', function() {
            const continuedContent = document.getElementById('continueStoryContent').textContent;
            if (continuedContent && !continuedContent.startsWith('ì˜¤ë¥˜')) {
                document.getElementById('storyContent').textContent = continuedContent;
                alert('ì´ì–´ì“´ ìŠ¤í† ë¦¬ê°€ ë©”ì¸ ìŠ¤í† ë¦¬ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.\nì´ì œ ì´ ìŠ¤í† ë¦¬ë¡œ ì¥ë©´ ë‚˜ëˆ„ê¸°, ê°€ê³µí•˜ê¸°, ì¶”ê°€ ì´ì–´ì“°ê¸°ë¥¼ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
        });

        // ì¥ë©´ ë‚˜ëˆ„ê¸°
        document.getElementById('splitSceneBtn').addEventListener('click', async function() {
            const storyContent = document.getElementById('storyContent').textContent;
            const openrouterKey = document.getElementById('openrouterKey').value.trim();
            
            if (!storyContent) {
                alert('ì¥ë©´ì„ ë‚˜ëˆŒ ìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (!openrouterKey) {
                alert('OpenRouter API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const button = this;
            const originalText = button.innerHTML;
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> ì²˜ë¦¬ì¤‘...';
            
            // ìš”ì²­ ë°ì´í„° êµ¬ì„±
            const requestData = {
                _openrouter_key: openrouterKey,
                story: storyContent
            };
            
            // API ì„¹ì…˜ í‘œì‹œ ë° ìš”ì²­ ë°ì´í„° í‘œì‹œ
            document.getElementById('splitSceneApiSection').classList.remove('hidden');
            document.getElementById('splitSceneRequestData').textContent = JSON.stringify({
                ...requestData,
                _openrouter_key: '***hidden***'  // ë³´ì•ˆì„ ìœ„í•´ í‚¤ ìˆ¨ê¹€
            }, null, 2);
            document.getElementById('splitSceneResponseData').textContent = 'ìš”ì²­ ì¤‘...';
            document.getElementById('splitSceneStatusBadge').innerHTML = '<span class="px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-semibold rounded-full">â³ ì²˜ë¦¬ì¤‘</span>';
            
            try {
                const response = await fetch('../split_scene.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                // ì‘ë‹µ ë°ì´í„° í‘œì‹œ
                document.getElementById('splitSceneResponseData').textContent = JSON.stringify(result, null, 2);
                
                if (result.success) {
                    document.getElementById('splitSceneStatusBadge').innerHTML = '<span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-semibold rounded-full">âœ“ ì„±ê³µ</span>';
                    document.getElementById('splitSceneContent').textContent = result.content;
                    
                    // í† í° ì •ë³´ í‘œì‹œ
                    if (result.token_info) {
                        document.getElementById('splitSceneTokenInfo').innerHTML = `
                            <span class="text-gray-600">ëª¨ë¸: ${result.model}</span> | 
                            <span class="text-blue-600">ì…ë ¥: ${result.token_info.input_tokens} í† í°</span> | 
                            <span class="text-green-600">ì¶œë ¥: ${result.token_info.output_tokens} í† í°</span>
                        `;
                    }
                } else {
                    document.getElementById('splitSceneStatusBadge').innerHTML = '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs font-semibold rounded-full">âœ— ì‹¤íŒ¨</span>';
                    document.getElementById('splitSceneContent').textContent = 'ì˜¤ë¥˜: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                }
            } catch (error) {
                document.getElementById('splitSceneStatusBadge').innerHTML = '<span class="px-2 py-1 bg-red-100 text-red-800 text-xs font-semibold rounded-full">âœ— ì—ëŸ¬</span>';
                document.getElementById('splitSceneResponseData').textContent = 'Error: ' + error.message;
                document.getElementById('splitSceneContent').textContent = 'ì˜¤ë¥˜ ë°œìƒ: ' + error.message;
            } finally {
                button.disabled = false;
                button.innerHTML = originalText;
            }
        });
        
        // ì¥ë©´ ë‚˜ëˆ„ê¸° ê²°ê³¼ ë³µì‚¬
        document.getElementById('copySplitSceneBtn').addEventListener('click', function() {
            const content = document.getElementById('splitSceneContent').textContent;
            navigator.clipboard.writeText(content).then(() => {
                const originalText = this.innerHTML;
                this.innerHTML = 'âœ“ ë³µì‚¬ë¨';
                setTimeout(() => {
                    this.innerHTML = originalText;
                }, 2000);
            });
        });
        
        // ê°€ê³µí•˜ê¸° (refine_story.htmlë¡œ ì´ë™)
        document.getElementById('refineStoryBtn').addEventListener('click', function() {
            const storyContent = document.getElementById('storyContent').textContent;
            
            if (!storyContent) {
                alert('ê°€ê³µí•  ìŠ¤í† ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // localStorageì— ë°ì´í„° ì €ì¥
            const refineData = {
                content: storyContent
            };
            localStorage.setItem('storyToRefine', JSON.stringify(refineData));
            
            // refine_story.htmlë¡œ ì´ë™
            window.location.href = 'refine_story.html';
        });
    </script>
</body>
</html>
