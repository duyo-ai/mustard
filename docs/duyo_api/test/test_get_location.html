<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ïû•ÏÜå Ï∂îÍ∞Ä API ÌÖåÏä§Ìä∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            max-width: 1000px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .scene-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 10px;
            transition: border-color 0.3s;
        }

        .scene-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .add-btn {
            background: #4CAF50;
            color: white;
        }

        .add-btn:hover {
            background: #45a049;
        }

        .remove-btn {
            background: #f44336;
            color: white;
        }

        .remove-btn:hover {
            background: #da190b;
        }

        .process-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }

        .process-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .process-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .load-example-btn {
            background: #FF9800;
            color: white;
        }

        .load-example-btn:hover {
            background: #F57C00;
        }

        .output-section {
            margin-top: 30px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            min-height: 200px;
            display: none;
        }

        .output-section.show {
            display: block;
        }

        .io-section {
            margin-top: 30px;
            padding: 20px;
            background: #263238;
            border-radius: 10px;
        }

        .io-header {
            color: #aed581;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
            font-family: 'Courier New', monospace;
        }

        .io-url {
            color: #64B5F6;
            font-size: 12px;
            margin-bottom: 10px;
            font-family: 'Courier New', monospace;
        }

        .json-display {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-x: auto;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #333;
            line-height: 1.5;
        }

        /* JSON Íµ¨Î¨∏ Í∞ïÏ°∞ */
        .json-key {
            color: #9CDCFE;
        }

        .json-string {
            color: #CE9178;
        }

        .json-number {
            color: #B5CEA8;
        }

        .json-boolean {
            color: #569CD6;
        }

        .json-null {
            color: #569CD6;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 5px 5px 0 0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
        }

        .tab-btn.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        h2 {
            color: #333;
            font-size: 20px;
        }

        .copy-btn {
            padding: 8px 16px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .copy-btn:hover {
            background: #1976D2;
        }

        .scene-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .location-tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 14px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .scene-text {
            color: #555;
            line-height: 1.6;
        }

        .raw-output {
            background: #263238;
            color: #aed581;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin-top: 20px;
        }

        .token-info {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
        }

        .token-item {
            text-align: center;
        }

        .token-label {
            color: #666;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .token-value {
            color: #667eea;
            font-size: 20px;
            font-weight: bold;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            border-radius: 8px;
            color: #c62828;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è Ïû•ÏÜå Ï∂îÍ∞Ä API ÌÖåÏä§Ìä∏</h1>
        
        <div class="input-section">
            <h2 style="margin-bottom: 15px;">Ïû•Î©¥ ÏûÖÎ†•</h2>
            <div id="sceneInputs">
                <input type="text" class="scene-input" placeholder="Ïû•Î©¥ 1ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." value="">
            </div>
            
            <div class="button-group">
                <button class="add-btn" onclick="addSceneInput()">+ Ïû•Î©¥ Ï∂îÍ∞Ä</button>
                <button class="remove-btn" onclick="removeSceneInput()">- Ïû•Î©¥ Ï†úÍ±∞</button>
                <button class="load-example-btn" onclick="loadExample()">ÏòàÏãú Î∂àÎü¨Ïò§Í∏∞</button>
            </div>
            
            <button class="process-btn" onclick="processScenes()" id="processBtn">
                Ïû•ÏÜå Ï†ïÎ≥¥ Ï∂îÍ∞ÄÌïòÍ∏∞
            </button>
        </div>

        <div class="output-section" id="outputSection">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('result')">Ï≤òÎ¶¨ Í≤∞Í≥º</button>
                <button class="tab-btn" onclick="switchTab('request')">ÏöîÏ≤≠ (Request)</button>
                <button class="tab-btn" onclick="switchTab('response')">ÏùëÎãµ (Response)</button>
            </div>

            <!-- Ï≤òÎ¶¨ Í≤∞Í≥º ÌÉ≠ -->
            <div id="resultTab" class="tab-content active">
                <div class="output-header">
                    <h2>Ï≤òÎ¶¨Îêú Ïû•Î©¥</h2>
                    <button class="copy-btn" onclick="copyToClipboard()">Í≤∞Í≥º Î≥µÏÇ¨</button>
                </div>
                <div id="processedScenes"></div>
                
                <div class="token-info" id="tokenInfo"></div>
                
                <h3 style="margin-top: 30px; margin-bottom: 10px;">GPT ÏõêÏãú Ï∂úÎ†•</h3>
                <div class="raw-output" id="rawOutput"></div>
            </div>

            <!-- ÏöîÏ≤≠ ÌÉ≠ -->
            <div id="requestTab" class="tab-content">
                <div class="io-section">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div class="io-header">HTTP Request</div>
                            <div class="io-url">POST <span id="apiUrl"></span></div>
                            <div class="io-header">Content-Type: application/json</div>
                        </div>
                        <button class="copy-btn" onclick="copyJSON('request')" style="margin-bottom: 10px;">Î≥µÏÇ¨</button>
                    </div>
                    <div class="json-display" id="requestJson"></div>
                </div>
            </div>

            <!-- ÏùëÎãµ ÌÉ≠ -->
            <div id="responseTab" class="tab-content">
                <div class="io-section">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div class="io-header">HTTP Response</div>
                            <div class="io-url">Status: <span id="statusCode">200 OK</span></div>
                            <div class="io-header">Content-Type: application/json</div>
                        </div>
                        <button class="copy-btn" onclick="copyJSON('response')" style="margin-bottom: 10px;">Î≥µÏÇ¨</button>
                    </div>
                    <div class="json-display" id="responseJson"></div>
                </div>
            </div>
        </div>

        <div id="errorSection"></div>
    </div>

    <script>
        let responseData = null;
        let requestData = null;

        function switchTab(tabName) {
            // Î™®Îì† ÌÉ≠ Î≤ÑÌäºÍ≥º ÏΩòÌÖêÏ∏† ÎπÑÌôúÏÑ±Ìôî
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // ÏÑ†ÌÉùÎêú ÌÉ≠ ÌôúÏÑ±Ìôî
            if (tabName === 'result') {
                document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
                document.getElementById('resultTab').classList.add('active');
            } else if (tabName === 'request') {
                document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
                document.getElementById('requestTab').classList.add('active');
            } else if (tabName === 'response') {
                document.querySelector('.tab-btn:nth-child(3)').classList.add('active');
                document.getElementById('responseTab').classList.add('active');
            }
        }

        function syntaxHighlight(json) {
            if (typeof json != 'string') {
                json = JSON.stringify(json, null, 2);
            }
            
            json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                let cls = 'json-number';
                if (/^"/.test(match)) {
                    if (/:$/.test(match)) {
                        cls = 'json-key';
                    } else {
                        cls = 'json-string';
                    }
                } else if (/true|false/.test(match)) {
                    cls = 'json-boolean';
                } else if (/null/.test(match)) {
                    cls = 'json-null';
                }
                return '<span class="' + cls + '">' + match + '</span>';
            });
        }

        function addSceneInput() {
            const container = document.getElementById('sceneInputs');
            const newInput = document.createElement('input');
            newInput.type = 'text';
            newInput.className = 'scene-input';
            newInput.placeholder = `Ïû•Î©¥ ${container.children.length + 1}ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî...`;
            container.appendChild(newInput);
        }

        function removeSceneInput() {
            const container = document.getElementById('sceneInputs');
            if (container.children.length > 1) {
                container.removeChild(container.lastElementChild);
            }
        }

        function loadExample() {
            const examples = [
                "Ïò§Îäò ÌöåÏÇ¨ÏóêÏÑú ÏßÑÏßú ÎØ∏Ïπú ÏùºÏùÑ Í≤™ÏóàÎã§. ÎÇòÎäî ÌèâÎ≤îÌïú ÌöåÏÇ¨ÏõêÏù∏Îç∞, Ïò§Îäò ÏïÑÏπ® Ï∂úÍ∑ºÌïòÎãàÍπå ÎÇ¥ ÏûêÎ¶¨Ïóê ÏûàÎçò Ïª¥Ìì®ÌÑ∞Í∞Ä Îã§Î•∏ Í±∏Î°ú Î∞îÎÄåÏñ¥ ÏûàÎçîÎùº.",
                "ÌåÄÏû•ÎãòÏù¥ Î∂ÄÎ•¥ÏãúÎçîÎãà Ï†Ñ ÏßÅÏõê Ìá¥ÏÇ¨Ìï¥ÏÑú Í∑∏ Ïª¥Ìì®ÌÑ∞ Ïì∞ÎùºÍ≥† ÌïòÏãúÎäî Í±∞ÏûÑ.",
                "Í∑ºÎç∞ Í∑∏ Ïª¥Ìì®ÌÑ∞ ÏºúÎ≥¥ÎãàÍπå Ï†Ñ ÏßÅÏõêÏù¥ ÏûëÏóÖÌïòÎçò ÌååÏùºÎì§Ïù¥ Í∑∏ÎåÄÎ°ú ÏûàÎäîÎç∞, Í±∞Í∏∞Ïóê ÌöåÏÇ¨ ÎπÑÎ¶¨ Í¥ÄÎ†® ÏûêÎ£åÎì§Ïù¥ ÏûîÎú© ÏûàÏóàÏùå.",
                "ÏùºÎã® USBÏóê Î∞±ÏóÖÌï¥ÎëêÍ≥† ÌåÄÏû•ÎãòÍªò Î≥¥Í≥†ÌñàÎçîÎãà ÏñºÍµ¥Ïù¥ ÌïòÏñóÍ≤å ÏßàÎ¶¨ÎçîÎùº.",
                "ÏßÄÍ∏à ÌöåÏÇ¨ ÎÇúÎ¶¨ÎÇ®. Í∞êÏÇ¨ÌåÄÏù¥Îûë Í≤ΩÏ∞∞ÍπåÏßÄ ÏôîÏùå.",
                "ÎÇòÎäî Í∑∏ÎÉ• Ïã†Í≥†Ïûê Î≥¥Ìò∏ ÌîÑÎ°úÍ∑∏Îû® Î∞õÍ≥† ÏßëÏóê ÏôîÎäîÎç∞, ÎÇ¥ÏùºÎ∂ÄÌÑ∞ Ï∂úÍ∑º Ïïà Ìï¥ÎèÑ ÎêúÎåÄ."
            ];

            const container = document.getElementById('sceneInputs');
            container.innerHTML = '';
            
            examples.forEach(example => {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'scene-input';
                input.value = example;
                container.appendChild(input);
            });
        }

        async function processScenes() {
            const inputs = document.querySelectorAll('.scene-input');
            const scenes = Array.from(inputs)
                .map(input => input.value.trim())
                .filter(value => value !== '');

            if (scenes.length === 0) {
                showError('ÏµúÏÜå 1Í∞ú Ïù¥ÏÉÅÏùò Ïû•Î©¥ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            // ÏöîÏ≤≠ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            requestData = { scenes: scenes };

            const processBtn = document.getElementById('processBtn');
            const outputSection = document.getElementById('outputSection');
            const errorSection = document.getElementById('errorSection');
            
            processBtn.disabled = true;
            processBtn.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            errorSection.innerHTML = '';
            outputSection.classList.remove('show');

            // API URL ÌëúÏãú
            const apiUrl = window.location.origin + window.location.pathname.replace(/[^\/]*$/, '') + 'get_location.php';
            document.getElementById('apiUrl').textContent = apiUrl;
            
            // ÏöîÏ≤≠ JSON ÌëúÏãú (Íµ¨Î¨∏ Í∞ïÏ°∞ Ï†ÅÏö©)
            document.getElementById('requestJson').innerHTML = syntaxHighlight(requestData);

            // Ïã§Ìñâ ÏãúÍ∞Ñ Ï∏°Ï†ï ÏãúÏûë
            const startTime = performance.now();

            try {
                const response = await fetch('../get_location.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                // ÏÉÅÌÉú ÏΩîÎìú ÌëúÏãú
                document.getElementById('statusCode').textContent = response.status + ' ' + response.statusText;
                
                const data = await response.json();
                responseData = data;
                
                // Ïã§Ìñâ ÏãúÍ∞Ñ Í≥ÑÏÇ∞
                const endTime = performance.now();
                const executionTime = ((endTime - startTime) / 1000).toFixed(2);
                responseData.executionTime = executionTime;

                // ÏùëÎãµ JSON ÌëúÏãú (Íµ¨Î¨∏ Í∞ïÏ°∞ Ï†ÅÏö©)
                document.getElementById('responseJson').innerHTML = syntaxHighlight(data);

                if (data.error) {
                    throw new Error(data.error);
                }

                displayResults(data, executionTime);
                outputSection.classList.add('show');
                
            } catch (error) {
                showError('Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                // Ïò§Î•ò Î∞úÏÉù ÏãúÏóêÎèÑ ÏùëÎãµ ÌëúÏãú
                if (error.message.includes('JSON')) {
                    document.getElementById('responseJson').innerHTML = syntaxHighlight({
                        error: 'ÏùëÎãµ ÌååÏã± Ïò§Î•ò',
                        message: error.message
                    });
                } else if (responseData) {
                    // ÏóêÎü¨Í∞Ä ÏûàÏñ¥ÎèÑ ÏùëÎãµ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥ ÌëúÏãú
                    outputSection.classList.add('show');
                }
            } finally {
                processBtn.disabled = false;
                processBtn.textContent = 'Ïû•ÏÜå Ï†ïÎ≥¥ Ï∂îÍ∞ÄÌïòÍ∏∞';
            }
        }

        function displayResults(data, executionTime) {
            // Ï≤òÎ¶¨Îêú Ïû•Î©¥ ÌëúÏãú
            const processedScenesDiv = document.getElementById('processedScenes');
            processedScenesDiv.innerHTML = '';
            
            if (data.processed_scenes && data.processed_scenes.length > 0) {
                data.processed_scenes.forEach(scene => {
                    const sceneItem = document.createElement('div');
                    sceneItem.className = 'scene-item';
                    
                    if (scene.location) {
                        sceneItem.innerHTML = `
                            <div class="location-tag">${scene.location}</div>
                            <div class="scene-text">${scene.scene}</div>
                        `;
                    } else {
                        sceneItem.innerHTML = `<div class="scene-text">${scene.scene}</div>`;
                    }
                    
                    processedScenesDiv.appendChild(sceneItem);
                });
            }

            // ÌÜ†ÌÅ∞ Ï†ïÎ≥¥ ÌëúÏãú
            if (data.token_info) {
                const tokenInfoDiv = document.getElementById('tokenInfo');
                tokenInfoDiv.innerHTML = `
                    <div class="token-item">
                        <div class="token-label">ÏûÖÎ†• ÌÜ†ÌÅ∞</div>
                        <div class="token-value">${data.token_info.input_tokens}</div>
                    </div>
                    <div class="token-item">
                        <div class="token-label">Ï∂úÎ†• ÌÜ†ÌÅ∞</div>
                        <div class="token-value">${data.token_info.output_tokens}</div>
                    </div>
                    <div class="token-item">
                        <div class="token-label">Ï¥ù ÌÜ†ÌÅ∞</div>
                        <div class="token-value">${data.token_info.total_tokens}</div>
                    </div>
                    <div class="token-item">
                        <div class="token-label">Ïã§Ìñâ ÏãúÍ∞Ñ</div>
                        <div class="token-value">${executionTime}Ï¥à</div>
                    </div>
                `;
            }

            // ÏõêÏãú Ï∂úÎ†• ÌëúÏãú
            const rawOutputDiv = document.getElementById('rawOutput');
            rawOutputDiv.textContent = data.raw_output || '';
        }

        function copyToClipboard() {
            if (responseData && responseData.raw_output) {
                navigator.clipboard.writeText(responseData.raw_output).then(() => {
                    alert('GPT Ï∂úÎ†•Ïù¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
                }).catch(err => {
                    alert('Î≥µÏÇ¨ Ïã§Ìå®: ' + err);
                });
            }
        }

        function copyJSON(type) {
            let dataToCopy = '';
            
            if (type === 'request' && requestData) {
                dataToCopy = JSON.stringify(requestData, null, 2);
            } else if (type === 'response' && responseData) {
                dataToCopy = JSON.stringify(responseData, null, 2);
            }
            
            if (dataToCopy) {
                navigator.clipboard.writeText(dataToCopy).then(() => {
                    alert(`${type === 'request' ? 'ÏöîÏ≤≠' : 'ÏùëÎãµ'} JSONÏù¥ ÌÅ¥Î¶ΩÎ≥¥ÎìúÏóê Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!`);
                }).catch(err => {
                    alert('Î≥µÏÇ¨ Ïã§Ìå®: ' + err);
                });
            } else {
                alert('Î≥µÏÇ¨Ìï† Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.');
            }
        }

        function showError(message) {
            const errorSection = document.getElementById('errorSection');
            errorSection.innerHTML = `<div class="error">${message}</div>`;
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú ÏòàÏãú ÏûêÎèô Î°úÎìú
        window.onload = function() {
            loadExample();
        };
    </script>
</body>
</html>
